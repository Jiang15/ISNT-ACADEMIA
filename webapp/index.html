<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Data Visualization</title>
        <style>

        .links line {
          stroke: #999;
          stroke-opacity: 0.6;
          stroke-width: 1.5px;
        }

        .nodes circle {
          stroke: #000;
          stroke-width: 0.5px;
        }

        text {
          font-family: sans-serif;
          font-size: 12px;
        }

        </style>
        <script>
        function showGraph(){
          // set the dimensions and margins of the graph
          var margin = {
            top: 80,
            right: 20,
            bottom: 30,
            left: 50
          };

          var width = 500 - margin.left - margin.right;
          var height = 500 - margin.top - margin.bottom;

          var host = window.location.hostname;
          if (host.indexOf('localhost') > -1) {
            //is development
            host = "http://" + host + ":3000";
          } else {
            // is production
            host = "https://" + host;
          }

          var student_name = document.getElementById("myText").value;
          console.log(student_name);
          var student_course_url = host + "/personal_graph/?student=" + encodeURIComponent(student_name);

          // clean the previous network if existing
          document.getElementById("personalGraph").innerHTML = "";

          var svg = d3.select("#personalGraph")
            .append("svg")
            .attr("width", width + margin.left + margin.right + 300)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform",
              "translate(" + margin.left + "," + margin.top + ")");

          var color = d3.scaleOrdinal(d3.schemeCategory20);
          var simulation = d3.forceSimulation()
            .force("link", d3.forceLink().id(function(d) { return d.id ; }).distance(200))
            .force("charge", d3.forceManyBody())
            .force("center", d3.forceCenter(width / 2, height / 2));

          // default implementation from: https://bl.ocks.org/heybignick/3faf257bbbbc7743bb72310d03b86ee8
          d3.json(student_course_url, function (error, graph) {
            console.log(graph)

            if (error) throw error;
            var link = svg.append("g")
              .attr("class", "links")
              .selectAll("line")
              .data(graph.links)
              .enter().append("line")
              .attr("stroke-width", function(d) { return Math.sqrt(d.value); });

            var node = svg.append("g")
              .attr("class", "nodes")
              .selectAll("g")
              .data(graph.nodes)
              .enter().append("g")

            var circle = node.append("circle")
              .attr("r", 20)
              .attr("fill", function(d) { return color(d.taken); })
              .call(d3.drag()
                .on("start", dragstarted)
                .on("drag", dragged)
                .on("end", dragended));

            var lables = node.append("text")
              .text(function(d) {
              return d.name;
              })
              .attr('text-anchor', 'middle')
              .attr('x', 3)
              .attr('y', 5);

            node.append("title")
              .text(function(d) { return d.name; });

            simulation
              .nodes(graph.nodes)
              .on("tick", ticked);

            simulation.force("link")
              .links(graph.links);

            function ticked() {
              link
                .attr("x1", function(d) { return d.source.x; })
                .attr("y1", function(d) { return d.source.y; })
                .attr("x2", function(d) { return d.target.x; })
                .attr("y2", function(d) { return d.target.y; });

              node
                .attr("transform", function(d) {
                  return "translate(" + d.x + "," + d.y + ")";
                })
            }

          });

          function dragstarted(d) {
            if (!d3.event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
          }

          function dragged(d) {
            d.fx = d3.event.x;
            d.fy = d3.event.y;
          }

          function dragended(d) {
            if (!d3.event.active) simulation.alphaTarget(0);
            d.fx = null;
            d.fy = null;
          }
        }
        </script>
    </head>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="app/css/main.css">
  <body>
    <div class="container-fluid" style="padding:0px;">
      <div class="row" id="header-ban">
          <div class="col" id="header-ban-left"></div>
      </div>
    </div>
    <div class="container-fluid" style="padding:0px;">
          <div class="card" style="border-radius: 0px; min-height: 87.6vh;">
            <div class="card-header">
              <ul class="nav nav-tabs card-header-tabs" id="menuList" role="tablist">
                <li class="nav-item">
                  <a class="nav-link active" href="#home" role="tab" aria-controls="home" aria-selected="true">Home</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link"  href="#explore" role="tab" aria-controls="explore" aria-selected="false">Explore</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="#personal" role="tab" aria-controls="personal" aria-selected="false">Personal</a>
                </li>
              </ul>
            </div>
            <div class="card-body" style="background: #e6e9e9;">
              <div class="container-fluid" id="content-tab">

              <div class="tab-content mt-3">
                <div class="tab-pane active" id="home" role="tabpanel">
                  <h4 class="card-title mh-100">Hi!</h4>
                  <p class="card-text">
                    We have made ISN'T ACADEMIA to <i>help students to select courses</i> at EPFL. </br>
                    We will provide general information to give an overview of courses and give customized suggestions by combining it with their personal data.
                  </p>
                  <p>So let me <i>introduce our website</i> quickly. </br>
                    You will notice 3 tabs on the top, our main visualizations will be in the Explore and General tabs. </br>
                    Feel free to take a look at them!
                  </p><p>
                    Enjoy! </br> Costanza, Eleonora and Wei</p>
                </div>

                <div class="tab-pane" id="explore" role="tabpanel" aria-labelledby="history-tab">
                  <h4 class="card-title mh-100">It is time to explore the trend of EPFL courses!</h4>
                  <p class="card-text">
                    On this page, you will be able to compare course popularity through the changes in the number of student enrollments over the years. </p>
                  <div id="bubbleCourses"></div>
                </div>

              <div class="tab-pane" id="personal" role="tabpanel" aria-labelledby="deals-tab">
                <h4 class="card-title mh-100">Which course should I do this semester?</h4>
                <p class="card-text">
                  We have created the course network to give suggestions on course selection. Just insert your name and remove the courses you didn't love (or the ones that you would have preferred to skip in the past).
                </p>
                <!--div id="relationsCourse"></div-->

                <input type="text" id="myText" value="Rocchi Eleonora">
                <button onclick="showGraph()">Try it</button>
                <div id="personalGraph"></div>
                <!-- <div>
                  <h6>Type the student name:</h6>
                      <input id="studentNameAutocomplete" type="text" class="typeahead tt-query" autocomplete="off" spellcheck="false">
                    <div id="loading-badges"> </div>
                      <div id="coursesbadges"></div>
                  </div> -->

              </div>
            </div>
            </div>
          </div>
    </div>
  </div>
</body>
<script src="https://code.jquery.com/jquery-3.4.0.js"></script>
<!-- <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script> -->
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
<script src="https://d3js.org/d3.v4.js"></script>
<script  type="text/javascript" src="app/js/typeahead.bundle.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<script src="app/js/main.js"></script>
<script src="app/js/bubble_courses.js"></script>
<script src="app/js/autocomplete_student_name.js"></script>
<script src="app/js/relations_course.js"></script>
</html>